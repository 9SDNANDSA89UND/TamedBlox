<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Complete â€” Enter Roblox Username</title>

<style>
body {
  margin: 0;
  padding: 0;
  background: radial-gradient(circle at top, #0f141a 40%, #050607 100%);
  font-family: 'Inter', sans-serif;
  color: #e8fff0;
}

.center-wrap {
  max-width: 420px;
  margin: 90px auto;
  padding: 32px;
  background: rgba(15,20,26,0.75);
  border: 1px solid rgba(78,245,138,0.35);
  border-radius: 20px;
  backdrop-filter: blur(18px);
  box-shadow:
    0 0 30px rgba(78,245,138,0.25),
    0 0 14px rgba(78,245,138,0.18),
    inset 0 0 10px rgba(255,255,255,0.05);
  text-align: center;
  animation: fadeIn 0.8s ease;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

h1 {
  font-size: 26px;
  font-weight: 900;
  margin-bottom: 6px;
  color: #4ef58a;
  text-shadow: 0 0 10px rgba(78,245,138,0.6);
}

.subtitle {
  margin-bottom: 22px;
  font-size: 15px;
  opacity: 0.85;
}

.input-box {
  margin-top: 18px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;
}

input {
  width: 90%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  border: 1px solid rgba(78,245,138,0.4);
  background: rgba(0,0,0,0.35);
  color: #d9ffea;
  outline: none;
  transition: 0.2s ease;
  box-shadow: inset 0 0 8px rgba(78,245,138,0.15);
}

input:focus {
  border-color: #4ef58a;
  box-shadow:
    0 0 10px rgba(78,245,138,0.35),
    inset 0 0 10px rgba(78,245,138,0.25);
}

button {
  width: 90%;
  padding: 14px;
  font-size: 17px;
  font-weight: 900;
  background: #4ef58a;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  color: #0c110f;
  transition: 0.2s ease;
  box-shadow: 0 0 12px rgba(78,245,138,0.45);
}

button:hover {
  transform: translateY(-2px) scale(1.03);
}

button:active {
  transform: scale(0.96);
}

#error {
  color: #ff6b6b;
  margin-top: 10px;
  display: none;
}

.avatar-preview {
  margin-top: 25px;
  display: none;
  animation: fadeIn 0.4s ease;
}

.avatar-preview img {
  width: 120px;
  border-radius: 12px;
  box-shadow:
    0 0 14px rgba(78,245,138,0.45),
    inset 0 0 8px rgba(78,245,138,0.22);
}
</style>
</head>

<body>

<div class="center-wrap">
  <h1>Order Complete</h1>
  <div class="subtitle">Enter your Roblox username so we can deliver your items.</div>

  <div class="input-box">
    <input id="rbxUser" placeholder="Roblox Username">
    <button id="continueBtn">Continue</button>
  </div>

  <div id="error">Please enter a username.</div>

  <div id="avatar" class="avatar-preview">
    <img id="avatarImg" src="">
    <div style="margin-top:8px; opacity:0.8;">Your Roblox Avatar</div>
  </div>
</div>

<script>
const params = new URLSearchParams(window.location.search);
const sessionId = params.get("session_id");

async function loadAvatar(username) {
  try {
    const res = await fetch(
      `https://thumbnails.roblox.com/v1/users/avatar?userIds=${username}&size=150x150&format=Png&isCircular=false`
    );
    const data = await res.json();
    if (data.data && data.data[0] && data.data[0].imageUrl) {
      document.getElementById("avatarImg").src = data.data[0].imageUrl;
      document.getElementById("avatar").style.display = "block";
    }
  } catch (e) {}
}

document.getElementById("rbxUser").addEventListener("input", (e) => {
  const user = e.target.value.trim();
  if (user.length > 0) loadAvatar(user);
});

document.getElementById("continueBtn").onclick = async () => {
  const user = document.getElementById("rbxUser").value.trim();

  if (!user) {
    document.getElementById("error").style.display = "block";
    return;
  }

  localStorage.setItem("postPurchaseRobloxUser", user);

  await fetch("https://website-5eml.onrender.com/pay/save-roblox-user", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      sessionId,
      robloxUser: user
    })
  });

  window.location.href = `/create-account.html?session_id=${sessionId}`;
};
</script>

</body>
</html>
